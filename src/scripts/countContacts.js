import { PATH_DB } from '../constants/contacts.js';
import * as fs from 'node:fs/promises';

export const countContacts = async () => {
  try {
    const data = await fs.readFile(PATH_DB, 'utf-8');
    const contacts = JSON.parse(data);
    if (!Array.isArray(contacts)) {
      throw new Error('Data is not an array');
    } else {
      const count = contacts.length;
      return count;
    }
  } catch (error) {
    if (error.code !== 'ENOENT') {
      throw error;
    }
  }
};

console.log(await countContacts());

// Алгоритм:
// Импортировать необходимые модули:

// Импортируйте модуль fs из Node.js для работы с файловой системой. Используйте версию с промисами (fs.promises), чтобы упростить работу с асинхронным кодом.
// Определить путь к файлу:

// Определите константу для пути к файлу src/db/db.json.
// Чтение файла:

// Создайте функцию, которая будет асинхронно читать содержимое файла db.json с помощью fs.readFile.
// Парсинг содержимого файла:

// Преобразуйте прочитанное содержимое из JSON-строки в JavaScript-объект с помощью JSON.parse.
// Проверка и получение контактов:

// Убедитесь, что прочитанные данные представляют собой массив контактов.
// Если данные не являются массивом, обработайте это (например, верните 0 или выбросьте ошибку).
// Подсчет контактов:

// Посчитайте количество элементов в массиве контактов, используя свойство length.
// Обработка ошибок:

// Добавьте обработку ошибок для случаев, когда файл не существует или данные некорректны.
// Возврат результата:

// Возвращайте количество контактов.
// Пошаговое описание:
// Импортируйте модуль fs с промисами:

// const fs = require('fs').promises;
// Определите путь к файлу:

// const PATH_DB = './src/db/db.json';
// Создайте асинхронную функцию countContacts:

// async function countContacts() { ... }
// Внутри функции countContacts, прочитайте файл:

// const data = await fs.readFile(PATH_DB, 'utf-8');
// Преобразуйте содержимое файла в объект:

// const contacts = JSON.parse(data);
// Проверьте, что прочитанные данные являются массивом:

// if (!Array.isArray(contacts)) { throw new Error('Data is not an array'); }
// Посчитайте количество контактов:

// const count = contacts.length;
// Верните количество контактов:

// return count;
// Добавьте обработку ошибок:

// Используйте try...catch блок для обработки ошибок чтения файла и парсинга данных.
// Таким образом, функция countContacts будет выглядеть следующим образом (без кода):

// Импортировать fs с промисами.
// Определить путь к файлу db.json.
// Создать асинхронную функцию countContacts.
// Прочитать файл db.json.
// Преобразовать содержимое файла в объект.
// Проверить, что данные являются массивом.
// Посчитать количество контактов.
// Вернуть количество контактов.
// Обработать возможные ошибки.
